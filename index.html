<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Betu ‚ù§Ô∏è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        /* Base Styles */
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background-color: #000;
        }
        .container {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: transform 0.8s ease-in-out;
        }
        .hidden { display: none !important; }
        .center-content {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100%; text-align: center; color: white; padding: 20px; box-sizing: border-box;
        }
        button {
            padding: 12px 24px; font-size: 1.2rem; border: none; border-radius: 25px;
            background-color: #ff4d4d; color: white; cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.2s; position: relative; z-index: 20;
        }
        button:hover { background-color: #e60000; }
        button:active { transform: scale(0.98); }
        input { padding: 12px; font-size: 1.1rem; border-radius: 8px; border: none; margin-top: 15px; text-align: center; color: #333; outline: none; }
        .message { font-size: 1.5rem; margin: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); position: relative; z-index: 10; font-weight: bold; }
        .next-arrow { font-size: 3rem; cursor: pointer; animation: bounce 2s infinite; margin-top: 20px; z-index: 20; position: relative; }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-7px); }
        }

        /* Section 1: Lock Screen (Native CSS Stars) */
        #lock-screen { 
            background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%); 
            z-index: 100; 
        }
        #error-msg { color: #ff4d4d; margin-top: 15px; font-size: 1.1rem; }

        /* Secret Vault */
        #secret-vault { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }

        /* Section 2: Cake & Countdown */
        #cake-section { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); transform: translateY(0); z-index: 5; }
        .falling-hearts span { position: absolute; top: -10%; font-size: 2rem; animation: fall linear infinite; z-index: 1; }
        @keyframes fall {
            0% { top: -10%; transform: translateX(0) rotate(0deg); opacity: 1; }
            100% { top: 110%; transform: translateX(50px) rotate(360deg); opacity: 0; }
        }
        #countdown { font-size: 6rem; font-weight: bold; text-shadow: 2px 2px 10px rgba(0,0,0,0.3); z-index: 10; position: relative; }
        
        /* Native Emoji Cake Setup */
        #cake-container { position: relative; margin-top: 30px; z-index: 10; font-size: 120px; line-height: 1; }
        .cake-decor { position: absolute; display: none; }
        #bunting { top: -70px; left: 50%; transform: translateX(-50%); width: 200px; font-size: 50px; white-space: nowrap; }
        #candle { top: -50px; left: 50%; transform: translateX(-50%); font-size: 50px; }
        #knife { top: 20px; right: -50px; font-size: 70px; cursor: pointer; transition: transform 0.2s; }
        #knife:hover { transform: scale(1.2) rotate(-10deg); }

        /* Section 3: Balloons */
        #balloon-section { background: linear-gradient(to bottom, #89f7fe 0%, #66a6ff 100%); transform: translateX(100%); z-index: 6; }
        .balloon-container { display: flex; justify-content: center; gap: 15px; margin-top: 50px; }
        .balloon { width: 70px; height: 90px; background-color: #ff4d4d; border-radius: 50%; position: relative; cursor: pointer; animation: float 3s ease-in-out infinite alternate; box-shadow: inset -10px -10px 20px rgba(0,0,0,0.3); }
        .balloon::before { content: ''; position: absolute; bottom: -15px; left: 50%; transform: translateX(-50%); width: 2px; height: 30px; background-color: rgba(255,255,255,0.8); }
        @keyframes float { 0% { transform: translateY(0); } 100% { transform: translateY(-20px); } }

        /* Section 4: Memory Lane */
        #memory-section { background: linear-gradient(120deg, #fbc2eb 0%, #a6c1ee 100%); transform: translateX(100%); z-index: 7; overflow-y: auto; }
        #first-photo { width: 85%; max-width: 350px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); margin-top: 20px; border: 4px solid white; }
        #typed-message { font-size: 1.3rem; line-height: 1.6; white-space: pre-wrap; text-align: center; max-width: 90%; margin: 20px auto; min-height: 100px; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); font-weight: bold; }

        /* Section 5: Grand Finale */
        #finale-section { background: #111; transform: translateY(100%); z-index: 8; }
        #final-video { width: 90%; max-width: 500px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(255,77,77,0.3); border: 2px solid #333; }

        /* Admin Panel */
        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8f9fa; color: #333; z-index: 200; padding: 25px; overflow-y: auto; }
        #admin-panel input, #admin-panel textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; margin-top: 8px; font-size: 1rem; }
        #admin-panel label { font-weight: bold; margin-top: 20px; display: block; color: #555; }
        #admin-panel h2 { color: #ff4d4d; text-align: center; font-size: 2rem; }
    </style>
</head>
<body>

    <audio id="birthday-song" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="romantic-song" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" type="audio/mpeg">
    </audio>
    <audio id="pop-sound">
        <source src="https://www.soundjay.com/button/sounds/button-3.mp3" type="audio/mpeg">
    </audio>

    <div id="lock-screen" class="container">
        <div class="center-content">
            <div class="message" style="font-size: 2rem;">enter your full name‚ù§Ô∏è</div>
            <input type="text" id="password-input" placeholder="Full Name...">
            <button onclick="checkPassword()">Unlock</button>
            <div id="error-msg" class="hidden">retry karo üòí<br><small style="font-weight: normal;">(Hint: 2 words with a space between them)</small></div>
        </div>
    </div>

    <div id="secret-vault">
        
        <div id="cake-section" class="container">
            <div class="falling-hearts" id="hearts-container"></div>
            <div class="center-content">
                <div id="countdown" class="hidden">3</div>
                <div id="cake-container" class="hidden">
                    <div id="bunting" class="cake-decor">üéäüéâüéä</div>
                    <div id="candle" class="cake-decor">üïØÔ∏è</div>
                    üéÇ
                    <div id="knife" class="cake-decor" onclick="cutCake()">üî™</div>
                </div>
                <button id="decorate-btn" class="hidden" onclick="decorateCake()">decorate</button>
                <div id="cake-message" class="message hidden">happy birthday mera betu ‚ù§Ô∏è</div>
                <div id="cake-arrow" class="next-arrow hidden" onclick="nextSection('balloon-section')">‚¨áÔ∏è</div>
            </div>
        </div>

        <div id="balloon-section" class="container">
            <div class="center-content">
                <div class="message">Pop all the balloons! üéà</div>
                <div class="balloon-container">
                    <div class="balloon" style="background-color: #ff4d4d;" onclick="popBalloon(this)"></div>
                    <div class="balloon" style="background-color: #ffd700;" onclick="popBalloon(this)"></div>
                    <div class="balloon" style="background-color: #4dff4d;" onclick="popBalloon(this)"></div>
                    <div class="balloon" style="background-color: #ff4dff;" onclick="popBalloon(this)"></div>
                </div>
                <div id="balloon-arrow" class="next-arrow hidden" onclick="nextSection('memory-section')">‚û°Ô∏è</div>
            </div>
        </div>

        <div id="memory-section" class="container">
            <div class="center-content">
                <button id="play-romantic-btn" onclick="playRomanticSong()">song for u bubuu ‚ñ∂Ô∏è</button>
                <div id="photo-container" class="hidden">
                    <img id="first-photo" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='300'><rect width='400' height='300' fill='%23ddd'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='20' font-family='sans-serif'>Your Photo Goes Here</text></svg>" alt="Our First Photo">
                    <div class="message">apni pahali photo which made me fall more for u mera bacha ü•∫</div>
                    <button id="read-msg-btn" onclick="typeMessage()">want to read what I wrote for u</button>
                    <div id="typed-message"></div>
                </div>
                <div id="memory-arrow" class="next-arrow hidden" onclick="nextSection('finale-section')">‚¨áÔ∏è</div>
            </div>
        </div>

        <div id="finale-section" class="container">
            <div class="center-content">
                <video id="final-video" controls>
                    <source src="" type="video/mp4">
                </video>
                <div class="message">thank u for coming in my life ‚ù§Ô∏èü•π<br>and once again wish u a very very happy birathday my betu</div>
            </div>
        </div>

    </div>

    <div id="admin-panel">
        <div style="max-width: 500px; margin: 0 auto;">
            <h2>Creator Dashboard ‚ú®</h2>
            <p style="text-align: center; color: #666;">Paste your GitHub links below to generate her surprise link.</p>
            
            <label>First Photo URL:</label>
            <input type="text" id="photo-url" placeholder="https://yourusername.github.io/repo/photo.jpg">
            
            <label>Final Video URL:</label>
            <input type="text" id="video-url" placeholder="https://yourusername.github.io/repo/video.mp4">
            
            <label>Your Long Emotional Message:</label>
            <textarea id="long-message" rows="5" placeholder="Type your heartfelt message here..."></textarea>
            
            <button style="width: 100%; margin-top: 30px;" onclick="generateGift()">Generate Magic Link & QR Code</button>
            
            <div id="generated-qr-container" class="hidden" style="text-align: center; margin-top: 30px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <canvas id="admin-qr-canvas"></canvas>
                <p id="final-link" style="word-break: break-all; margin-top: 15px; font-size: 0.9rem; color: #0066cc;"></p>
            </div>
        </div>
    </div>

    <script>
        let balloonsPopped = 0;
        const password = "shivani thakur"; 
        const birthdaySong = document.getElementById('birthday-song');
        const romanticSong = document.getElementById('romantic-song');
        const popSound = document.getElementById('pop-sound');
        
        // Explicitly track the current section to prevent sliding errors
        let currentSectionId = 'cake-section';

        function checkPassword() {
            const input = document.getElementById('password-input').value.trim().toLowerCase();
            if (input === password) {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('secret-vault').style.display = 'block';
                startCelebration();
            } else {
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        function startCelebration() {
            createHearts();
            startCountdown();
            try {
                let playPromise = birthdaySong.play();
                if (playPromise !== undefined) { playPromise.catch(error => {}); }
            } catch (e) {}
        }

        function createHearts() {
            const container = document.getElementById('hearts-container');
            for (let i = 0; i < 40; i++) {
                const heart = document.createElement('span');
                heart.innerHTML = Math.random() > 0.5 ? '‚ù§Ô∏è' : 'üíã';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDuration = (Math.random() * 3 + 4) + 's';
                heart.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(heart);
            }
        }

        function startCountdown() {
            const countdownEl = document.getElementById('countdown');
            countdownEl.classList.remove('hidden');
            let count = 3;
            countdownEl.innerText = count;
            
            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.innerText = count;
                } else {
                    clearInterval(interval);
                    countdownEl.classList.add('hidden');
                    document.getElementById('cake-container').classList.remove('hidden');
                    document.getElementById('decorate-btn').classList.remove('hidden');
                }
            }, 1000);
        }

        function decorateCake() {
            document.getElementById('decorate-btn').classList.add('hidden');
            document.getElementById('bunting').style.display = 'block';
            document.getElementById('candle').style.display = 'block';
            setTimeout(() => { document.getElementById('knife').style.display = 'block'; }, 600);
        }

        function cutCake() {
            document.getElementById('knife').style.display = 'none'; // hide knife after cutting
            document.getElementById('cake-message').classList.remove('hidden');
            document.getElementById('cake-arrow').classList.remove('hidden');
        }

        function nextSection(nextId) {
            const currentEl = document.getElementById(currentSectionId);
            const nextEl = document.getElementById(nextId);

            if (nextId === 'balloon-section' || nextId === 'memory-section') {
                currentEl.style.transform = 'translateX(-100%)';
                nextEl.style.transform = 'translateX(0)';
            } else {
                currentEl.style.transform = 'translateY(-100%)';
                nextEl.style.transform = 'translateY(0)';
            }
            
            currentSectionId = nextId; // Update tracking variable
            
            if (nextId === 'memory-section') { birthdaySong.pause(); }
        }

        function popBalloon(balloon) {
            if (balloon.style.opacity === '0') return;
            try {
                popSound.currentTime = 0;
                let popPromise = popSound.play();
                if (popPromise !== undefined) popPromise.catch(e => {});
            } catch (e) {}
            
            balloon.style.opacity = '0'; // Hide cleanly instead of visibility
            balloon.style.pointerEvents = 'none';
            balloonsPopped++;
            if (balloonsPopped === 4) { document.getElementById('balloon-arrow').classList.remove('hidden'); }
        }

        function playRomanticSong() {
            document.getElementById('play-romantic-btn').classList.add('hidden');
            try { romanticSong.play(); } catch(e) {}
            document.getElementById('photo-container').classList.remove('hidden');
        }

        function typeMessage() {
            document.getElementById('read-msg-btn').classList.add('hidden');
            const messageContainer = document.getElementById('typed-message');
            const urlParams = new URLSearchParams(window.location.search);
            const messageText = urlParams.get('msg') || "You are my everything. Thank you for making every day brighter. Happy Birthday! ‚ù§Ô∏è";
            
            let i = 0;
            const speed = 4000 / Math.max(messageText.length, 1);

            function typeWriter() {
                if (i < messageText.length) {
                    messageContainer.innerHTML += messageText.charAt(i);
                    i++;
                    setTimeout(typeWriter, speed);
                } else {
                    document.getElementById('memory-arrow').classList.remove('hidden');
                }
            }
            typeWriter();
        }
        
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('admin')) {
                document.getElementById('admin-panel').style.display = 'block';
            } else {
                const photoUrl = urlParams.get('photo');
                const videoUrl = urlParams.get('video');
                if (photoUrl) document.getElementById('first-photo').src = photoUrl;
                if (videoUrl) document.querySelector('#final-video source').src = videoUrl;
                document.getElementById('final-video').load();
            }
        };

        function generateGift() {
            const photoUrl = document.getElementById('photo-url').value;
            const videoUrl = document.getElementById('video-url').value;
            const message = document.getElementById('long-message').value;

            if (!photoUrl || !videoUrl || !message) { alert("Please fill in all fields!"); return; }

            const baseUrl = window.location.href.split('?')[0];
            const finalLink = `${baseUrl}?photo=${encodeURIComponent(photoUrl)}&video=${encodeURIComponent(videoUrl)}&msg=${encodeURIComponent(message)}`;

            document.getElementById('final-link').innerHTML = `<strong>Your Link:</strong><br><a href="${finalLink}" target="_blank">${finalLink}</a>`;
            new QRious({ element: document.getElementById('admin-qr-canvas'), value: finalLink, size: 220, foreground: '#ff4d4d', level: 'H' });
            document.getElementById('generated-qr-container').classList.remove('hidden');
        }
    </script>
</body>
</html>
